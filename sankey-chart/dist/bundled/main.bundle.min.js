!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SankeyChartLibrary=e():t.SankeyChartLibrary=e()}(this,(()=>(()=>{"use strict";var t,e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};e.r(i),e.d(i,{EventHandler:()=>s,IncludeKind:()=>t,SankeyChart:()=>o,SankeyChartData:()=>n}),function(t){t.WITH_SAME_TARGET="WITH_SAME_TARGET"}(t||(t={}));class n{constructor(t,e){this.getNodeTagColor=t=>{const e=t.tags?t.tags.map((t=>{var e;return null===(e=this.options.tagColorMap)||void 0===e?void 0:e[t]})).find((t=>void 0!==t)):this.options.defaultColor;return t.color||e},this.selectedNode=void 0,this.nodes=[],this.dependencies={relations:[],hasRelatedSourceOfOtherKinds:!1},this.height=0,this.originalData={name:t.name,color:t.color,nodes:t.nodes||[],relations:t.relations||[]},this.nodesByKinds={},this.title=void 0,this.options={noTag:"Others",noTagSuffixCharacter:"…",relationDefaultWidth:15,trafficLog10Factor:12,defaultColor:"orange",tagColorMap:{},kinds:[],showRelatedKinds:!1,selectAndFilter:!0},this.setOptions(e)}initialize(){this.initializeSortRelations(),this.initializeRelationsInfo(),this.sortNodes(this.nodes)}resetColors(){if(this.options.tagColorMap){const t=Object.keys(this.options.tagColorMap);this.nodes.forEach((e=>{t.some((t=>{var i;return null===(i=e.tags)||void 0===i?void 0:i.includes(t)}))&&delete e.color}))}else this.nodes.forEach((t=>delete t.color))}setOptions(t){this.resetColors(),this.options=Object.assign(Object.assign({},this.options),t);const e=this.selectedNode;this.initialize(),this.selectedNode=void 0,this.selectNode(e)}appendData(t,e){this.selectedNode=void 0,this.mergeData(this.originalData,t),this.initialize(),this.selectNode(e)}getNodes(){return this.nodes||[]}getNodesByKind(t){var e;return null!==(e=this.nodesByKinds[t])&&void 0!==e?e:[]}getRelations(){return this.dependencies.relations||[]}getKinds(){var t,e;const i=Object.keys(this.nodesByKinds);return(null===(e=null===(t=this.options)||void 0===t?void 0:t.kinds)||void 0===e?void 0:e.length)>0?this.options.kinds.filter((t=>i.includes(t.name))):i.map((t=>({name:t})))}getTitle(){return this.title}setTitle(t){this.title=t?{title:t.title,name:t.name,color:t.color}:void 0}getSelectedNode(){return this.selectedNode}selectNode(t){const e=e=>{const i={};e.forEach((t=>{i[t.kind]||(i[t.kind]=[]),i[t.kind].push(t)}));for(const e in i)this.options.selectAndFilter&&t&&e===t.kind?i[e].sort(((e,i)=>e.name===t.name?-1:i.name===t.name?1:e.name.localeCompare(i.name))):i[e].sort(((t,e)=>t.name.localeCompare(e.name)));return i};if(t){if(!t.kind||!t.name)throw new Error("Node must have kind and name");if(this.selectedNode&&t.name===this.selectedNode.name&&t.kind===this.selectedNode.kind)return this.selectedNode;if(this.selectedNode=this.originalData.nodes.find((e=>e.name===t.name&&e.kind===t.kind)),this.selectedNode){const t=this.options.kinds.find((t=>{var e;return t.name===(null===(e=this.selectedNode)||void 0===e?void 0:e.kind)}));(null==t?void 0:t.includeAlternative)?this.selectedNode.hasRelatedSourceOfOtherKinds=!0:delete this.selectedNode.hasRelatedSourceOfOtherKinds,this.selectedNode.hasRelatedSourceOfOtherKinds=!!(null==t?void 0:t.includeAlternative),this.options.selectAndFilter&&(this.options.showRelatedKinds?this.dependencies=this.filterDependencies(this.selectedNode,t):this.dependencies=this.filterDependencies(this.selectedNode),this.nodes=this.filterNodes(this.dependencies.relations),this.nodes.forEach((t=>{t.hasRelatedSourceOfSameKind=!!this.dependencies.relations.find((e=>e.target.kind===t.kind&&e.target.name===t.name&&e.source.kind===t.kind))})),this.updateRelationWeights(this.nodes,this.dependencies.relations,this.selectedNode))}else this.nodes=[];this.nodesByKinds=e(this.nodes)}else this.nodes=this.originalData.nodes,this.dependencies.relations=this.originalData.relations||[],this.nodesByKinds=e(this.nodes),this.updateRelationWeights(this.nodes,this.dependencies.relations),this.selectedNode=void 0;return this.selectedNode}sortNodes(t){const e=(this.options.noTag||"")+this.options.noTagSuffixCharacter;t.sort(((t,i)=>t.name===e&&i.name!==e?1:t.name!==e&&i.name===e?-1:0))}initializeSortRelations(){var t;null===(t=this.originalData.relations)||void 0===t||t.sort(((t,e)=>t.source.kind!==e.source.kind?t.source.kind.localeCompare(e.source.kind):t.source.name.localeCompare(e.source.name))).sort(((t,e)=>t.source.kind===e.source.kind&&t.source.name===e.source.name?t.target.kind!==e.target.kind?t.target.kind.localeCompare(e.target.kind):t.target.name.localeCompare(e.target.name):0))}initializeRelationsInfo(){var t;const e={};null===(t=this.originalData.relations)||void 0===t||t.forEach((t=>{const i=t.source.kind+"::"+t.source.name;e[i]||(e[i]={sourceCount:0,targetCount:0,refs:0}),t.source.kind===t.target.kind?e[i].refs++:e[i].sourceCount++;const n=t.target.kind+"::"+t.target.name;e[n]||(e[n]={sourceCount:0,targetCount:0,refs:0}),e[n].targetCount++}));const i=[];this.originalData.nodes.forEach((t=>{const n=e[t.kind+"::"+t.name];if(t.color=this.getNodeTagColor(t),t.targetCount||t.sourceCount){if(t.cardinality={sourceCount:t.sourceCount,targetCount:t.targetCount,fetchMore:!0,refs:0},t.sourceCount){delete t.sourceCount;const e=this.appendNextNode(t,-1);e&&i.push(e)}if(t.targetCount){delete t.targetCount;const e=this.appendNextNode(t,1);e&&i.push(e)}}else t.cardinality=n})),i.forEach((t=>{this.originalData.nodes.push(t)}))}getIndexByKind(t,e){var i,n;const s=null===(n=null===(i=this.options)||void 0===i?void 0:i.kinds)||void 0===n?void 0:n.findIndex((e=>e.name===t));if(s>-1){let t=s+e;return t<0||t>=this.options.kinds.length?-1:t}return-1}appendNextNode(t,e){const i=this.getIndexByKind(t.kind,e);if(i>-1){const n={kind:this.options.kinds[i].name,name:"…",placeHolder:!0},s=-1===e?{source:n,target:t}:{source:t,target:n};return this.originalData.relations.push(s),n}}searchByName(t){if(!t.kind||!t.name)throw new Error("Filter criteria is empty");return this.originalData.nodes.filter((e=>e.kind===t.kind&&e.name.includes(t.name)))}findByName(t,e){return e.find((e=>e.name===t))}filterDependencies(t,e){let i=[];const n=this.getKinds().map((t=>t.name));let s=this.originalData.relations.filter((e=>e.source.kind===t.kind&&e.source.name===t.name&&(!(n.length>0)||n.includes(e.target.kind))));if(0==s.length){const e=this.originalData.relations.filter((e=>e.target.kind===t.kind&&e.target.name===t.name&&(!(n.length>0)||n.includes(e.source.kind)))),i=e.map((t=>t.source.name));s=this.originalData.relations.filter((e=>e.source.kind===t.kind&&i.includes(e.source.name))),s.push(...e)}const o=s?[...new Set(s.flatMap((t=>`${t.target.kind}::${t.target.name}`)))]:[],r=this.originalData.relations.filter((t=>(!(n.length>0)||n.includes(t.target.kind))&&o.includes(t.source.kind+"::"+t.source.name)));if(null==e?void 0:e.includeAlternative){const t=[...new Set(s.flatMap((t=>`${t.target.kind}::${t.target.name}`)))];i=this.originalData.relations.filter((i=>t.includes(`${i.target.kind}::${i.target.name}`)&&e.name===i.source.kind))}const a=this.originalData.relations.filter((e=>(!(n.length>0)||n.includes(e.target.kind))&&e.target.kind===t.kind&&e.target.name===t.name)),d=a?[...new Set(a.flatMap((t=>`${t.target.kind}::${t.target.name}`)))]:[],l=this.originalData.relations.filter((t=>(!(n.length>0)||n.includes(t.target.kind))&&d.includes(`${t.target.kind}::${t.target.name}`))),h=[...new Set([...s,...r,...l,...i,...a].map((t=>JSON.stringify(t))))].map((t=>JSON.parse(t)));return t.hasRelationsOfSameKinds=!!h.find((e=>e.source.kind===t.kind||e.target.kind===t.kind)),{relations:h,hasRelatedSourceOfOtherKinds:i.length>0}}filterNodes(t){const e=t.flatMap((t=>`${t.target.kind}::${t.target.name}`)),i=t.flatMap((t=>`${t.source.kind}::${t.source.name}`));this.selectedNode&&i.push(`${this.selectedNode.kind}::${this.selectedNode.name}`);const n=[...new Set(e.concat(i))];return this.originalData.nodes.filter((t=>n.includes(`${t.kind}::${t.name}`)))}updateRelationWeights(t,e,i){if(!e)return;const n=e.reduce(((t,e)=>{var i,n,s;const{source:o,target:r,analytics:a}=e;if(o.kind===r.kind)return e.height=0,t;const d=`s${o.kind}:${o.name}`,l=`t${r.kind}:${r.name}`;let h=a;const c=h&&"traffic"in h&&(null!==(i=h.traffic)&&void 0!==i?i:0)>0?Math.round(Math.log10(Math.max(h.traffic,2)||2)*(null!==(n=this.options.trafficLog10Factor)&&void 0!==n?n:12)):null!==(s=this.options.relationDefaultWidth)&&void 0!==s?s:10;return e.height=c,t[d]=(t[d]||0)+c,t[l]=(t[l]||0)+c,t}),{});t.forEach((t=>{var e,i;t.height=Math.max(null!==(e=n[`s${t.kind}:${t.name}`])&&void 0!==e?e:0,null!==(i=n[`t${t.kind}:${t.name}`])&&void 0!==i?i:0)}))}mergeData(t,e){return e.nodes.forEach((e=>{const i=t.nodes.findIndex((t=>t.kind===e.kind&&t.name===e.name));if(-1!==i){const n=t.nodes[i];t.relations.filter((t=>n.kind===t.source.kind&&n.name===t.source.name||n.kind===t.target.kind&&n.name===t.target.name)).forEach((e=>{const i=t.relations.indexOf(e);-1!==i&&t.relations.splice(i,1)})),t.nodes[i]=e}else t.nodes.push(e)})),e.relations.forEach((e=>{-1===t.relations.findIndex((t=>t.source.kind===e.source.kind&&t.source.name===e.source.name&&t.target.kind===e.target.kind&&t.target.name===e.target.name))&&t.relations.push(e)})),t}}class s{constructor(){this.listeners=new Map}subscribe(t,e){var i;this.listeners.has(t)||this.listeners.set(t,[]),null===(i=this.listeners.get(t))||void 0===i||i.push(e)}unsubscribe(t,e){if(this.listeners.has(t)){const i=this.listeners.get(t),n=i.indexOf(e);-1!==n&&i.splice(n,1)}}dispatchEvent(t,e){if(this.listeners.has(t)){const i=this.listeners.get(t).slice();for(const t of i)t(e)}}}const o=class{constructor(t,e){this.SVG_NS="http://www.w3.org/2000/svg",this.showContextMenu=t=>{var e,i;const n=this.contextMenuElement,s={node:null===(e=this.chartData)||void 0===e?void 0:e.getSelectedNode()},o=(null===(i=this.contextMenuDynamicLinks)||void 0===i?void 0:i.call(this,s))||[];o.length>0&&(n.innerHTML="",o.forEach((t=>{const e=document.createElement("div");e.className="context-item",e.textContent=t.label,e.setAttribute("data-url",t.url),e.setAttribute("data-target",t.target||""),e.addEventListener("click",this.openPage),n.appendChild(e)})),document.addEventListener("click",this.closeContextMenu),t.preventDefault(),n.style.left=`${t.clientX}px; contextMenu!.style.top = ${t.clientY}px`,n.style.display="block")},this.openPage=t=>{const e=t.currentTarget,i=e.getAttribute("data - url"),n=e.getAttribute("data - target")||"_self";i&&window.open(i,n)},this.closeContextMenu=()=>{const t=this.contextMenuElement;t&&(t.style.display="none",document.removeEventListener("click",this.closeContextMenu))},this.renderNodes=(t,e,i,n)=>{var s,o;const r=document.createElementNS(this.SVG_NS,"g");let a=this.options.topY;null===(s=this.chartData)||void 0===s||s.getKinds;const d=e+this.options.nodeWidth/2,l=this.options.topY+this.options.marginY+this.options.nodeWidth/2;let h=e+this.options.nodeWidth+this.options.nodeMarginY/2;const c=this.options.topY+this.options.marginY+this.options.nodeWidth;if(this.options.renderKindAsColums)if(null==n?void 0:n.title){let t="";if(n.color){const t=this.createCircle(d,l,5,n.color||this.options.defaultNodeColor);r.appendChild(t)}else t="| ",h-=13;const e=this.createSvgText(t+n.title,[this.className.NODE_TYPE_TITLE]);e.setAttribute("x",h.toString()),e.setAttribute("y",c.toString()),r.appendChild(e),a+=25}else if(null===(o=this.chartData)||void 0===o?void 0:o.getTitle()){const t=this.chartData.getTitle(),e=this.createCircle(d,l,5,(null==t?void 0:t.color)||this.options.defaultNodeColor);r.appendChild(e);const i=this.createSvgText((null==t?void 0:t.name)||"",[this.className.NODE_TYPE_TITLE]);i.setAttribute("x",h.toString()),i.setAttribute("y",c.toString()),r.appendChild(i),a+=25}return t.forEach(((t,n)=>{var s,o,d;const l=null!==(s=t.height)&&void 0!==s?s:0,h=t.cardinality?10:-20,c=i&&i.name===t.name&&i.kind===t.kind,u=h+Math.max(l+2*this.options.marginY,this.options.nodeMinHeight+(this.options.renderKindAsColums?0:10)+(t.subtitle?10:0)),p=this.options.marginY+a,g=t.color||this.options.defaultNodeColor;let m=e,f=this.options.nodeColumnWith;c&&(this.selectedNodePositionY=p),t.hasRelatedSourceOfSameKind&&(m+=this.options.relation.sameKindIndentation,f-=this.options.relation.sameKindIndentation);const v=document.createElementNS("http://www.w3.org/2000/svg","g"),S=document.createElementNS("http://www.w3.org/2000/svg","rect");S.setAttribute("x",m.toString()),S.setAttribute("y",p.toString()),S.setAttribute("width",f.toString()),S.setAttribute("height",u.toString()),S.setAttribute("rx","5"),S.setAttribute("ry","5"),S.setAttribute("fill",g),S.setAttribute("filter","url(#dropshadow)"),S.setAttribute("opacity","0");const k=document.createElementNS("http://www.w3.org/2000/svg","rect");if(k.setAttribute("x",m.toString()),k.setAttribute("y",p.toString()),k.setAttribute("width",this.options.nodeWidth.toString()),k.setAttribute("height",u.toString()),k.setAttribute("rx","5"),k.setAttribute("ry","5"),k.setAttribute("fill",g),c){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",String(m-2)),t.setAttribute("y",String(p-2)),t.setAttribute("width",String(this.options.nodeWidth+4)),t.setAttribute("height",String(u+4)),t.setAttribute("rx","6"),t.setAttribute("ry","6"),this.options.selectedNode.dropShadow?(t.setAttribute("fill","black"),t.setAttribute("filter","url(#dropshadow)"),t.setAttribute("opacity","0.2")):this.options.selectedNode.borderColor&&(t.setAttribute("stroke-width","2"),t.setAttribute("stroke",this.options.selectedNode.borderColor),t.setAttribute("fill","none"),t.setAttribute("opacity","1")),v.appendChild(t)}v.appendChild(k),S.style.cursor="pointer",v.appendChild(S);const N=t.cardinality;if(N){if(null!==(o=N.sourceCount)&&void 0!==o&&o){const t=this.createSvgText("- "+N.sourceCount+(N.refs>0?"+":""),[this.className.CARDINALITY,c?this.className.SELECTED:""]);t.setAttribute("x",String(m+this.options.marginX-6)),t.setAttribute("y",String(p+u-2)),t.setAttribute("fill",g),v.appendChild(t)}if(null!==(d=N.targetCount)&&void 0!==d&&d){const t=this.createSvgText(N.targetCount+" -",[this.className.CARDINALITY,c?this.className.SELECTED:""]);t.setAttribute("x",String(m+this.options.marginX-14)),t.setAttribute("y",String(p+u-2)),t.setAttribute("fill",g),t.setAttribute("text-anchor","end"),v.appendChild(t)}}const C=this.createSvgText("",[this.className.NODE_TITLE,c?this.className.SELECTED:""]);C.setAttribute("x",String(m+this.options.marginX)),C.setAttribute("y",p.toString());const b=[this.truncateName(t.title?t.title:t.name,this.options.nameMaxLength)];t.tags&&b.push(t.tags.join(", ")),this.options.renderKindAsColums||b.push(t.kind.charAt(0).toUpperCase()+t.kind.slice(1));let y=0,A=-1;if(t.subtitle){const e=this.truncateName(t.subtitle,this.options.nameMaxLength);b.splice(1,0,e),y=1,A=0}for(let t=0;t<b.length;t++){const e=document.createElementNS(this.SVG_NS,"tspan");e.setAttribute("x",String(m+this.options.marginX)),e.setAttribute("dy","1.2em"),e.textContent=b[t],t===y?e.classList.add("headline"):t===A?e.classList.add("subtitle"):e.classList.add("description"),C.appendChild(e)}v.appendChild(C),(null==t?void 0:t.placeHolder)||(S.addEventListener("click",(e=>{var i,n;null===(i=this.chartData)||void 0===i||i.selectNode(t),this.render(),(null===(n=null==t?void 0:t.cardinality)||void 0===n?void 0:n.fetchMore)&&this.eventHandler.dispatchEvent("fetchData",{node:t}),this.eventHandler.dispatchEvent("selectionChanged",{node:t,position:{y:this.selectedNodePositionY}}),S.setAttribute("opacity",this.options.selectedNode.hoverOpacity.toString())})),S.addEventListener("mouseover",(t=>{S.setAttribute("opacity",this.options.selectedNode.hoverOpacity.toString())})),S.addEventListener("mouseout",(t=>{S.setAttribute("opacity","0")}))),r.appendChild(v),c&&!(null==t?void 0:t.placeHolder)&&this.contextMenuElement&&r.appendChild(this.renderElipsisMenu(m,p)),this.nodePositions[t.kind+"::"+t.name]={x:m,y:p,index:n,sourceY:p+this.options.marginY,targetY:p,h:u,color:t.color},a=a+u+this.options.nodeMarginY})),this.calculatedHeight=Math.max(this.calculatedHeight,a+2*this.options.nodeMarginY),r},this.createSvgText=(t,e)=>{const i=document.createElementNS(this.SVG_NS,"text");return i.classList.add(...e.filter((t=>t))),i.textContent=t,i},this.renderRelations=(t,e)=>{const{name:i,kind:n,color:s}=e||{},o=s||this.options.defaultNodeColor,r=JSON.parse(JSON.stringify(this.nodePositions)),a=document.createElementNS(this.SVG_NS,"g"),d=document.createElementNS(this.SVG_NS,"g");null==t||t.forEach((t=>{var s,l,h,c;document.createElementNS(this.SVG_NS,"g");const u=r[t.source.kind+"::"+t.source.name],p=r[t.target.kind+"::"+t.target.name];if(!p||!u)return;const g=u.color||o,{source:m,target:f,height:v}=t,S=u.x+this.options.nodeWidth,k=u.sourceY+(v||0)/2,N=p.targetY+(v||0)/2+5,C=(u.x+this.options.nodeWidth+p.x)/2;let b,y=this.options.relation.opacity,A=v;if((t.source.kind===n&&t.source.name===i||t.target.kind===n&&t.target.name===i)&&(y+=this.options.relation.selectedOpacity),m.kind===f.kind){if(u.index<p.index){const t=u.x+this.options.nodeWidth/2,e=u.y+u.h,i=p.x+this.options.nodeWidth/2,n=p.y+p.h/2;b=`M${t},${e} C${t},${n} ${t},${n} ${i},${n}`}else{const t=u.x+this.options.nodeWidth/2,e=u.y+u.h/2,i=p.x+this.options.nodeWidth/2;b=`M${i},${p.y+p.h} C${i},${e} ${i},${e} ${t},${e}`}y=.8,A=2}else b=`M${S},${k} C${C},${k} ${C},${N} ${p.x},${N}`;const E=document.createElementNS("http://www.w3.org/2000/svg","path");let x;if(E.setAttribute("d",b),E.setAttribute("fill","none"),E.setAttribute("stroke-width",String(A||0)),E.setAttribute("stroke",g),d.appendChild(E),x);else{x=t.analytics;t.target.kind===(null==e?void 0:e.kind)||(t.source.kind,null==e||e.kind)}if(null!==(s=null==x?void 0:x.traffic)&&void 0!==s&&s){const t=this.createSvgText("",[this.className.RELATION]);t.setAttribute("x",String(p.x-this.options.marginY)),t.setAttribute("y",String(p.targetY+(v||0)+8)),t.setAttribute("text-anchor","end");const e=document.createElementNS(this.SVG_NS,"tspan");if(e.textContent=(null==x?void 0:x.environment)||"",t.appendChild(e),(null==x?void 0:x.environment)&&this.options.relation.environment[null==x?void 0:x.environment]&&E.setAttribute("stroke-dasharray",this.options.relation.environment[x.environment].dashArray),null!==(l=null==x?void 0:x.errors)&&void 0!==l&&l){const e=100/(null!==(h=null==x?void 0:x.traffic)&&void 0!==h?h:0)*(null!==(c=null==x?void 0:x.errors)&&void 0!==c?c:0),i=document.createElementNS(this.SVG_NS,"tspan");i.setAttribute("fill","red"),i.textContent=" "+(0==e?"(<0.01%)":"("+e.toFixed(2).toLocaleString()+"%)"),t.appendChild(i)}const i=document.createElementNS(this.SVG_NS,"tspan");i.textContent=" "+(null==x?void 0:x.traffic.toLocaleString()),t.appendChild(i),a.appendChild(t),y+=this.options.relation.analyticsOpacity}else m.kind,f.kind;u.sourceY+=v,p.targetY+=v,E.setAttribute("opacity",String(y))})),this.svgElement.appendChild(d),this.svgElement.appendChild(a)},this.options={nodeWidth:10,nodeMinHeight:65,marginX:15,marginY:5,leftX:15,topY:10,nodeMarginY:10,nameMaxLength:50,nodeColumnWith:300,defaultNodeColor:"gray",renderKindAsColums:!0,relation:{selectedOpacity:.2,analyticsOpacity:.2,opacity:.2,environment:{nonPROD:{dashArray:"10,1"}},sameKindIndentation:20},selectedNode:{dropShadow:!1,scale:1.2,borderColor:"#ff1010",hoverOpacity:.2,hoverColor:"#141414"},ellipseCharacter:"…",rootCharacter:"⌂"},this.setOptions(e||{}),this.calculatedHeight=0,this.svgElement=t,this.nodePositions={},this.eventHandler=new s,this.contextMenuElement=void 0,this.contextMenuDynamicLinks=void 0,this.className={NODE_TYPE_TITLE:"node-kind-title",NODE_TITLE:"node-title",RELATION:"relation",CARDINALITY:"cardinality",SELECTED:"selected"},this.selectedNodePositionY=-1}setOptions(t){this.options=this._deepMerge(this.options,t)}setData(t){this.chartData!==t&&(this.chartData=t,this.render(),this.eventHandler.dispatchEvent("selectionChanged",{node:this.chartData.getSelectedNode(),position:{y:0}}))}getData(){return this.chartData}addSelectionChangedListeners(t){var e;"function"==typeof t&&(this.eventHandler.subscribe("selectionChanged",t),t({node:null===(e=this.chartData)||void 0===e?void 0:e.getSelectedNode(),position:{y:0}}))}addContextMenuListeners(t,e){"function"==typeof e&&(this.contextMenuElement=t,this.contextMenuDynamicLinks=e)}addFetchDataListeners(t){"function"==typeof t&&this.eventHandler.subscribe("fetchData",t)}truncateName(t,e){return t&&(null==t?void 0:t.length)>e?t.substring(0,e-3)+this.options.ellipseCharacter:t||""}resetSvg(){this.calculatedHeight=0,this.svgElement.innerHTML='\n      <defs>\n        <filter id="dropshadow">\n          <feGaussianBlur stdDeviation="0.4" />\n        </filter>\n      </defs>\n    '}updateHeight(){var t;const e=(this.options.nodeColumnWith+this.options.nodeWidth)*Math.max(1,(null===(t=this.chartData)||void 0===t?void 0:t.getKinds().length)||0)+2*this.options.marginX;this.svgElement.setAttribute("height",this.calculatedHeight.toString()),this.svgElement.setAttribute("width",e.toString())}renderElipsisMenu(t,e){const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("id","ellipsisMenu"),i.setAttribute("style","cursor: pointer;"),i.setAttribute("transform",`translate(${t+2.5}, ${e})`),i.addEventListener("click",this.showContextMenu);const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x","-2.5"),n.setAttribute("y","0"),n.setAttribute("width",this.options.nodeWidth.toString()),n.setAttribute("height","22"),n.setAttribute("rx","5"),n.setAttribute("ry","5"),n.setAttribute("fill","black"),n.setAttribute("opacity","0.2"),i.appendChild(n);for(let t=5;t<=15;t+=5){const e=this.createCircle(2.5,t,2,"white");i.appendChild(e)}return i}createCircle(t,e,i,n){const s=document.createElementNS("http://www.w3.org/2000/svg","circle");return s.setAttribute("cx",t.toString()),s.setAttribute("cy",e.toString()),s.setAttribute("r",i.toString()),s.setAttribute("fill",n),s}_deepMerge(t,e){if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return e;for(const i of Object.keys(e))Array.isArray(e[i])?t[i]=e[i].slice():"object"==typeof e[i]&&null!==e[i]?(t[i]||(t[i]={}),this._deepMerge(t[i],e[i])):t[i]=e[i];return t}render(){var t,e,i,n,s;const o=null===(t=this.chartData)||void 0===t?void 0:t.getSelectedNode();this.resetSvg();let r=0;const a=this.options.nodeColumnWith+this.options.nodeWidth,d=null===(e=this.chartData)||void 0===e?void 0:e.getKinds();this.selectedNodePositionY=-1;const l=document.createElementNS(this.SVG_NS,"g");d&&d.length>0?d.forEach((t=>{var e,i;l.appendChild(this.renderNodes(null!==(i=null===(e=this.chartData)||void 0===e?void 0:e.getNodesByKind(t.name))&&void 0!==i?i:[],this.options.leftX+a*r++,o,t))})):l.appendChild(this.renderNodes(null!==(n=null===(i=this.chartData)||void 0===i?void 0:i.getNodes())&&void 0!==n?n:[],this.options.leftX+0)),this.renderRelations(null===(s=this.chartData)||void 0===s?void 0:s.getRelations(),o),this.svgElement.appendChild(l),this.updateHeight()}};return window.SankeyChart=o,window.SankeyChartData=n,window.EventHandler=s,i})()));